{% extends "base.html" %}
{% block content %}
<div class="flex">
    <!-- 왼쪽 사이드바 -->
    <div class="bg-white shadow p-4">
        <div class="mb-4">
            <input
                type="text"
                placeholder="검색어를 입력해주세요."
                class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
        </div>
        <!-- <div class="mb-4 flex space-x-2">
            <button class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">전체보기</button>
            <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">변동이 높은</button>
            <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">인기있는</button>
        </div> -->
        <div>
            <table class="min-w-full table-auto border-collapse border border-gray-300">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-4 py-2 text-left font-bold text-gray-600">가상화폐 명</th>
                        <th class="px-4 py-2 text-left font-bold text-gray-600">현재가</th>
                        <th class="px-4 py-2 text-left font-bold text-gray-600">변동폭</th>
                    </tr>
                </thead>
                <tbody>
                    {% for data in market_data %}
                    <tr class="border-b hover:bg-gray-100" onclick="goToDetail('{{ data.market }}', 'buy')" style="cursor: pointer;">
                        <td class="px-4 py-2">
                            <span class="font-medium text-gray-900">{{ data.korean_name }}</span>
                            <br />
                            <span class="text-sm text-gray-500">{{ data.english_name }}</span>
                        </td>
                        <td class="px-4 py-2 font-semibold text-gray-700">{{ data.current_price|floatformat:0 }}KRW</td>
                        <td class="px-4 py-2 {% if coin.change > 0 %}text-green-500{% else %}text-red-500{% endif %} font-semibold">
                            {{ data.change_rate|floatformat:1 }}%
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- 오른쪽 메인 콘텐츠 -->
    <div class="w-3/4 p-4">
        {% for detail in crypto_detail %}
        <div class="bg-white p-6 rounded-lg shadow">
            <!-- 상단 -->
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h2 class="text-2xl font-bold">{{ detail.korean_name }}</h2>
                    <p class="text-gray-500">{{ detail.market }}</p>
                </div>
                <div class="text-right">
                    <p class="text-3xl font-bold">{{ detail.trade_price|floatformat:0 }}</p>
                    <p class="text-green-500">+0.00%</p>
                </div>
            </div>
            <!-- 버튼 -->
            <div class="mb-4 flex space-x-2">
                <button class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">1분</button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">10분</button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">30분</button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">1시간</button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">사용자 지정</button>
            </div>

            <!-- 차트 -->
            <div class="relative mb-4">
                <canvas id="cryptoChart" width="400" height="200"></canvas>
            </div>

            <!-- 하단 -->
            <div class="grid grid-cols-2 gap-4">
                <!-- 시세 -->
                <div>
                    <h3 class="text-lg font-bold mb-2">시세</h3>
                    <ul class="text-red-500">
                        <li>매도1: 0,000,000</li>
                        <li>매도2: 0,000,000</li>
                    </ul>
                    <ul class="text-blue-500">
                        <li>매수1: 0,000,000</li>
                        <li>매수2: 0,000,000</li>
                    </ul>
                </div>

                <!-- 주문 -->
                <div>
                    <h3 class="text-lg font-bold mb-2">매수 / 매도</h3>
                    <form>
                        <div class="mb-2">
                            <label class="block text-sm font-medium">가격</label>
                            <input type="text" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div class="mb-2">
                            <label class="block text-sm font-medium">수량</label>
                            <input type="text" class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <button type="submit" class="w-full bg-black text-white py-2 rounded-lg">주문</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('cryptoChart').getContext('2d');
    const cryptoChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['10:00', '10:01', '10:02', '10:03'], // 시간 데이터
            datasets: [{
                label: '가격',
                data: [10000, 10200, 10100, 10500], // 가격 데이터
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { title: { display: true, text: '시간' } },
                y: { title: { display: true, text: '가격 (KRW)' }, beginAtZero: false }
            }
        }
    });
    // 가상화폐 클릭 시 URL 파라미터 변경
    function goToDetail(code, type) {
        const url = new URL(window.location.href);
        url.searchParams.set('code', code);
        url.searchParams.set('type', type);
        window.location.href = url.toString();
    }

    function change(type) {
        const url = new URL(window.location.href);
        url.searchParams.set('type', type);
        window.location.href = url.toString();
    }
</script>
{% endblock %}